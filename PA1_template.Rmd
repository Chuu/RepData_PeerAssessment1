# Reproducible Research: Peer Assessment 1


## Loading and preprocessing the data
* Step 1: Read the data from the .zip file into our environment
```{r, echo=TRUE}
pa1.data <- read.csv(unzip("activity.zip"), header=TRUE,
                     colClasses = c("integer","Date","integer"));
```

## What is mean total number of steps taken per day?

* Step 1 : Create a function to Generate Histogram of number of steps taken by Date, then call it
```{r, echo=TRUE, results="asis"}
generateStepHist <- function(x)
  {
    hist(sapply(split(x$steps, x$date), sum), 
         xlab="Steps", main="Steps Taken by Date");
  };
generateStepHist(pa1.data)
```

* Step 2: Generate a function which generates a data frame with mean and median by date, then use kable to format it as a table

```{r, echo=TRUE, results="asis"}
generateStepMeanMedianByDateTable <- function(table)
  {
    aggregation <- aggregate(steps ~ date, data=table, FUN=sum);
    kable(data.frame(Mean=mean(aggregation$steps), Median=median(aggregation$steps)))
  }

generateStepMeanMedianByDateTable(pa1.data)
```

## What is the average daily activity pattern?
* First, we're going to aggregate the data by interval
```{r, echo=TRUE, results="asis"}
pa1.stepsByInterval <- aggregate(steps~interval, pa1.data, mean);
```
* Then, plot it.
```{r, echo=TRUE, results="asis"}
plot(pa1.stepsByInterval, main="Average Steps by 5-minute Interval", type="l")
```
* Discovering the maximum 5-minute inteval is trivial
```{r, echo=TRUE}
pa1.Interval <- pa1.stepsByInterval$interval[
  pa1.stepsByInterval$steps == max(pa1.stepsByInterval$steps)];
pa1.Interval
```

* But let's convert that to a more human readable form

```{r, echo=TRUE}
pa1.Interval.StartTime <- as.POSIXlt("1970-01-01", tz="UTC") + 60*pa1.Interval;
pa1.Interval.EndTime <- pa1.Interval.StartTime + 60*5;
c(Start=strftime(pa1.Interval.StartTime, format="%H:%M:%S", usetz=TRUE),
  End=strftime(pa1.Interval.EndTime, format="%H:%M:%S", usetz=TRUE))
```


## Imputing missing values

* First, we need to calculate the total number of rows with NAs.  We will be using mapply
over each row to discover if any element is NA and then summing the resulting matrix.  We don't want to is.na over every element since a row could have multiple is.na values.

```{r, echo=TRUE}
sum(mapply(function(x,y,z) { is.na(x) || is.na(y) || is.na(z) }, 
           pa1.data$steps, pa1.data$date, pa1.data$interval))
```

To fill in the missing step values, we're going to use the mean value of that interval for the entire data set.  Specifically, we're going to extract every row that has a NA step count, merge that datatable with a datatable with the mean by interval step counts, then concat the result with the original table minus rows with NA values.

This apporoach is flawed for a great variety of reasons, one of which we're going to see very shortly (i.e. the difference between Weekday and Weekend walking patterns), but it's the simplest method we have avaliable and is fine to use as a baseline to improve upon and measure against.

We are cheating alittle here by assuming that only step values have na's when before we assumed any value could -- but for our current data set this assumption holds.

```{r, echo=TRUE}
pa1.MeanStepByInterval <- aggregate(steps~interval, pa1.data, function(x) mean(x,na.rm=TRUE));
pa1.MissingSteps <- pa1.data[which(is.na(pa1.data$steps)), ];
pa1.MissingSteps <- merge(pa1.MeanStepByInterval, pa1.MissingSteps[, 2:3]);
pa1.DataFilled <- rbind(pa1.data[which(!is.na(pa1.data$steps)), ], pa1.MissingSteps);
```

* Now we redo the analysis from the first section of this study.  Because we did not stop to consider the distribution of NA values, we cannot form a hypothsis as to what we would expect the change to be.
```{r, echo=TRUE, results="asis"}
generateStepHist(pa1.DataFilled)
generateStepMeanMedianByDateTable(pa1.DataFilled)
```
The mean is the same, the median is now equal to the mean, when previously it was 1 step off.  The fact the median is now equal to the mean is interesting but not significant since it only represents a very small step and we never studied the distribution of NA values.

## Are there differences in activity patterns between weekdays and weekends?
